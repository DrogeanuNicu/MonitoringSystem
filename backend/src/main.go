package main

import (
	"backend/src/configParser"
	"backend/src/dashboard"
	"backend/src/db"
	"backend/src/mqtt"
	"backend/src/web"
	"context"
	"flag"

	_ "github.com/lib/pq"
)

// ================================================================================================
//
//	Global Types
//
// ================================================================================================

// ================================================================================================
//
//	Local Types
//
// ================================================================================================

// ================================================================================================
//
//	Global Variables
//
// ================================================================================================

// ================================================================================================
//
//	Local Variables
//
// ================================================================================================

// ================================================================================================
//
//	Global Functions
//
// ================================================================================================

// ================================================================================================
//
//	Local Functions
//
// ================================================================================================
func main() {
	var config configParser.Config
	var configFile string

	flag.StringVar(&configFile, "c", "../backend.config.json", "The config file")
	flag.Parse()

	ctx, cancel := context.WithCancel(context.Background())
	defer cancel()

	configParser.ReadConfig(&configFile, &config)
	go db.Init(&config.Database)
	go mqtt.Init(&ctx, &config.Mqtts, config.Debug)
	go dashboard.Init(&config.Dashboard)
	web.Init(&config.Https, config.Debug)
}
